const mongoose = require('mongoose')
const crypto = require('crypto')
const Schema = mongoose.Schema


const PayloadSchema = new Schema({
  uid: { type: String },
  created_at: { type: Date, default: Date.now, expires: 3600 },
  type: { type: String },
  data: { type: Schema.Types.Mixed },
  bill_uid: { type: String },
  flow_uid: { type: String },
  user_uid: { type: String },
  url: { type: String },
  sync: { type: Boolean, default: false }
})

PayloadSchema.pre('save', function (next) {
  var id = 'pay' + crypto.randomBytes(18).toString('hex')
  this.uid = id
  next()
})


mongoose.model('Payload', PayloadSchema)
module.exports = ['Payload', PayloadSchema]